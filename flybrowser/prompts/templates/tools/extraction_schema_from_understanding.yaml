# Copyright 2026 Firefly Software Solutions Inc
# Licensed under the Apache License, Version 2.0

name: extraction_schema_from_understanding
version: "1.0.0"
description: "Phase 2: Generate formal JSON Schema from extraction understanding"

system_template: |
  You are a JSON Schema expert. Your job is to convert example data structures into formal JSON schemas.
  
  Follow JSON Schema Draft 7 specification exactly.
  
  ## CRITICAL RULES:
  1. Use the EXACT field names from the example data
  2. Infer correct types from example values:
     - String values → "type": "string"
     - Number values → "type": "number" 
     - Arrays → "type": "array" with items definition
     - Objects → "type": "object" with nested properties
     - Booleans → "type": "boolean"
  3. Add helpful descriptions for each field
  4. Mark the most important field(s) as required
  5. NEVER use generic field names like "extracted_data", "data", "items"
  6. Return ONLY valid JSON - no markdown, no explanations
  
  ## Output Format:
  {
    "type": "object",
    "properties": {
      "field_name": {"type": "string", "description": "Field description"}
    },
    "required": ["most_important_field"]
  }

user_template: |
  ## Extraction Goal
  {{ goal }}
  
  ## Data Type
  {{ data_type }}
  
  ## Fields to Include
  {{ example_fields | join(", ") }}
  
  ## Example Data Structure
  ```json
  {{ example_data | tojson(indent=2) }}
  ```
  
  {% if reasoning %}
  ## Context
  {{ reasoning }}
  {% endif %}
  
  ## Your Task
  Convert the example data structure above into a formal JSON Schema that:
  1. Uses the exact field names from the example
  2. Has correct types inferred from the example values
  3. Includes helpful descriptions for each field
  4. Marks important fields as required
  
  Return ONLY the JSON schema, no other text.

required_variables:
  - goal
  - data_type
  - example_fields
  - example_data

optional_variables:
  reasoning: ""

examples:
  - input: |
      goal: Extract company information
      data_type: company
      example_fields: ["company_name", "tagline", "founded"]
      example_data: {"company_name": "Acme Corp", "tagline": "Innovation", "founded": 2020}
    output: |
      {
        "type": "object",
        "properties": {
          "company_name": {"type": "string", "description": "Official company name"},
          "tagline": {"type": "string", "description": "Company tagline or slogan"},
          "founded": {"type": "number", "description": "Year the company was founded"}
        },
        "required": ["company_name"]
      }

metadata:
  category: "extraction"
  use_case: "schema_generation"
  requires_vision: false
  avg_tokens: 600
  supports_streaming: false
